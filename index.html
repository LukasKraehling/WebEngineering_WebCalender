<!DOCTYPE html>
<html lang="en">
  <head>
    <!--Website-Title-->
    <title>Ci-Ca-Calendar</title>

    <!--Required meta tags-->
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, shrink-to-fit=no"
    />

    <!--Bootstrap CSS-->
    <link
      rel="stylesheet"
      href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
      integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T"
      crossorigin="anonymous"
    />

    <!-- External CSS-Stylesheet-->
    <link rel="stylesheet" href="style.css" />

    <!--Dependencies-->
    <!--jQuery-->
    <script
      src="https://code.jquery.com/jquery-3.4.1.min.js"
      integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo="
      crossorigin="anonymous"
    ></script>
    <!--Popper JS-->
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.15.0/umd/popper.min.js"
      integrity="sha256-fTuUgtT7O2rqoImwjrhDgbXTKUwyxxujIMRIK7TbuNU="
      crossorigin="anonymous"
    ></script>
    <!--Bootstrap JS-->
    <script
      src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"
      integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM"
      crossorigin="anonymous"
    ></script>
  </head>

  <body>
    <div class="site">
      <div class="header">
        <p>Ci-Ca-Calender</p>
      </div>

      <div class="content">
        <div class="menu d-flex justify-content-center flex-rows">
          <button id="MonthBeforeBtn" type="button" class="btn btn-primary">
            Previous month
          </button>
          <div id="currentDate"></div>
          <button id="MonthAfterBtn" type="button" class="btn btn-primary">
            Next month
          </button>
        </div>
        <button id="viewBtn" type="button" class="btn btn-primary">
          Change view
        </button>
        <div class="content-calendar">
          <div
            id="calendar"
            class="d-flex justify-content-center flex-wrap flex-rows calendar"
          ></div>
        </div>
      </div>
    </div>
  </body>

  <!-- Calendar-Javascript-->
  <script>
    //###Constants###
    const USERNAME = "18222";
    const SERVICE_URL = "https://dhbw.cheekbyte.de/calendar/" + USERNAME + "/"; //DHBW-Usernames
    const MONTH_NAMES = [
      "January",
      "February",
      "March",
      "April",
      "May",
      "June",
      "July",
      "August",
      "September",
      "October",
      "November",
      "December"
    ];

    //###Variables(var)###
    var currentDate = new Date();

    //###Main-Script####
    //Example
    /*
    addEvent(
      "test",
      null,
      "lukas.K98@web.de",
      "2014-12-24T00:00",
      "2014-12-25T23:59",
      "Busy",
      "true",
      null,
      null,
      null,
      null
    );
    */

    reloadDays(currentDate.getMonth(), currentDate.getYear() + 1900); //Start with current date

    //###Functions###
    //Function to create as many day-divs as the current month has and overrides the old day-divs
    function reloadDays() {
      //Delete all children ;D
      while (document.getElementById("calendar").hasChildNodes()) {
        document
          .getElementById("calendar")
          .removeChild(document.getElementById("calendar").firstChild);
      }

      //Add new children matching the requested month
      for (
        let index = 1;
        index <= daysInMonth(currentDate.getMonth() + 1, currentDate.getYear());
        index++
      ) {
        day = document.createElement("div");
        day.innerHTML = "Day " + index;
        day.id = index;

        document.getElementById("calendar").appendChild(day);
      }

      //Update Date-Indicator
      document.getElementById("currentDate").innerHTML =
        MONTH_NAMES[currentDate.getMonth()] +
        " " +
        (currentDate.getYear() + 1900);
    }

    //Function to give back the number of days that the given month has
    function daysInMonth(month, year) {
      return new Date(year, month, 0).getDate();
    }

    //Function to get all events from the remote-database
    function getEvents() {
      $.ajax({
        url: SERVICE_URL + "events",
        success: function(data) {
          return data;
        },
        error: function(error) {
          alert(
            "Could not get events: " + error.status + " " + error.statusText
          );
          return null;
        }
      });
    }

    //Function to add an event to the remote-database !!!TODO!!! (Fix image-Data and categories)
    function addEvent(
      title,
      location,
      organizer, //Mandatory
      start, //Mandatory
      end, //Mandatory
      status, //Mandatory
      allday, //Mandatory
      webpage,
      imageData,
      categories,
      extra
    ) {
      $.ajax({
        url: SERVICE_URL + "events",
        type: "POST",
        dataType: "json",
        data:
          '{"title":"' +
          title +
          '",' +
          '"location": "' +
          location +
          '",' +
          '"organizer": "' +
          organizer +
          '",' +
          '"start": "' +
          start + //Format: 2014-12-24T18:00
          '",' +
          '"end": "' +
          end + //Format: 2014-12-24T23:30
          '",' +
          '"status": "' +
          status +
          '",' +
          '"allday":' +
          allday +
          "," +
          '"webpage": "' +
          webpage +
          '",' +
          '"image data": null,' +
          '"categories": [],' +
          '"extra":"' +
          extra +
          '"}',
        success: function(data) {
          return true;
        },
        error: function(error) {
          alert(
            "Could not add event: " + error.status + " " + error.statusText
          );
          return false;
        }
      });
    }

    //Function to retrieve an event from the remote-database
    function retrieveEvent(id) {
      $.ajax({
        url: SERVICE_URL + "events/" + id,
        success: function(data) {
          return true;
        },
        error: function(error) {
          alert(
            "Could not retrieve event: " + error.status + " " + error.statusText
          );
          return false;
        }
      });
    }

    //Function to update an event at the remote-database !!!TODO!!! (Fix image-Data and categories)
    function updateEvent(
      eventId,
      title,
      location,
      organizer, //Mandatory
      start, //Mandatory
      end, //Mandatory
      status, //Mandatory
      allday, //Mandatory
      webpage,
      imageData,
      categories,
      extra
    ) {
      $.ajax({
        url: SERVICE_URL + "events/" + eventId,
        type: "PUT",
        dataType: "json",
        data:
          '{"title":"' +
          title +
          '",' +
          '"location": "' +
          location +
          '",' +
          '"organizer": "' +
          organizer +
          '",' +
          '"start": "' +
          start + //Format: 2014-12-24T18:00
          '",' +
          '"end": "' +
          end + //Format: 2014-12-24T23:30
          '",' +
          '"status": "' +
          status +
          '",' +
          '"allday":' +
          allday +
          "," +
          '"webpage": "' +
          webpage +
          '",' +
          '"image data": null,' +
          '"categories": [],' +
          '"extra":"' +
          extra +
          '"}',
        success: function(data) {
          return true;
        },
        error: function(error) {
          alert(
            "Could not update event: " + error.status + " " + error.statusText
          );
          return false;
        }
      });
    }

    //Function to delete an event from the remote-database
    function deleteEvent(id) {
      $.ajax({
        url: SERVICE_URL + "events/" + id,
        type: "DELETE",
        success: function(data) {
          return true;
        },
        error: function(error) {
          alert(
            "Could not delete event: " + error.status + " " + error.statusText
          );
          return false;
        }
      });
    }

    //###JQuery Code###
    //"Month after"-button functionality
    $("#MonthAfterBtn").on("click", function() {
      if (currentDate.getMonth() == 11) {
        currentDate = new Date(currentDate.getFullYear() + 1, 0, 1);
      } else {
        currentDate.setMonth(currentDate.getMonth() + 1);
      }
      reloadDays();
    });

    //"Month before"-button functionality
    $("#MonthBeforeBtn").on("click", function() {
      if (currentDate.getMonth() == 0) {
        currentDate = new Date(currentDate.getFullYear() - 1, 11, 1);
      } else {
        currentDate.setMonth(currentDate.getMonth() - 1);
      }
      reloadDays();
    });

    $("#calendar > div").mouseenter(function() {
      //hover day
      $(this).addClass("onhover");
      //get element the mouse hovers on
      var dayID = this.id;
      //add a div for hovered day content
      var dayBody = $("<div/>").attr({
        id: "daybody"
      });
      var dayBodyHeader = $("<div/>").attr({
        id: "daybodyheader"
      });
      $(dayBodyHeader).append("<p> Day " + dayID + "</p>");

      //add a line for adding entry---------------------
      var entryLine = $("<div/>").attr({
        id: "entryline"
      });
      //add the button for adding entry
      var addBtn = $("<input/>").attr({
        type: "button",
        class: "detailview btn btn-primary",
        id: "addbtn",
        value: "Add"
      });
      var nameField = $("<input/>").attr({
        type: "text",
        class: "detailview form-control inputf",
        id: "namefield"
      });
      var dateField = $("<input/>").attr({
        type: "date",
        class: "detailview form-control inputf",
        id: "datefield"
      });

      $(entryLine).append(addBtn);
      $(entryLine).append(nameField);
      $(entryLine).append(dateField);

      //------------------------------------------------

      var termin1 = $("<div/>").attr({
        id: "termin1"
      });
      var remBtn = $("<input/>").attr({
        type: "button",
        class: "detailview apmnt btn btn-primary",
        id: "rembtn",
        value: "Remove"
      });
      $(termin1).append(remBtn);

      $(dayBody).append(dayBodyHeader);
      $(dayBody).append(entryLine);
      $(dayBody).append(termin1);

      $(document).on("click", "#calendar > div", function() {
        $(".content-calendar").append(dayBody);
        $("#calendar").unbind("hover");
      });
    });
    $("#calendar > div").mouseleave(function() {
      $(this).removeClass("onhover");

      $(document).on("click", ".site", function(e) {
        if ($(e.target).closest("#daybody").length == 0) {
          $("#daybody").remove();
        }
      });
    });
    $(document).on("click", "#addbtn", function() {
      if (
        $("#datefield").val().length >= 0 &&
        $("#datefield").val().length >= 0
      ) {
        //!!!need to add event here!!!
      }
    });
  </script>
</html>
